{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the Tripify application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        },
        "dateJoined": {
          "type": "string",
          "description": "Date and time the user joined Tripify.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "FlightSearch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FlightSearch",
      "type": "object",
      "description": "Represents a user's flight search query.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the flight search."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N FlightSearch)"
        },
        "origin": {
          "type": "string",
          "description": "Origin airport code (IATA)."
        },
        "destination": {
          "type": "string",
          "description": "Destination airport code (IATA)."
        },
        "departureDate": {
          "type": "string",
          "description": "Departure date for the flight search.",
          "format": "date"
        },
        "adults": {
          "type": "number",
          "description": "Number of adults for the flight search."
        },
        "searchTimestamp": {
          "type": "string",
          "description": "Timestamp of when the search was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "origin",
        "destination",
        "departureDate",
        "adults"
      ]
    },
    "FlightOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FlightOffer",
      "type": "object",
      "description": "Represents a specific flight offer returned from a search.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the flight offer."
        },
        "searchId": {
          "type": "string",
          "description": "Reference to FlightSearch. (Relationship: FlightSearch 1:N FlightOffer)"
        },
        "price": {
          "type": "number",
          "description": "Total price of the flight offer."
        },
        "airlineCode": {
          "type": "string",
          "description": "Airline code (IATA)."
        },
        "departureTime": {
          "type": "string",
          "description": "Departure time of the flight.",
          "format": "date-time"
        },
        "arrivalTime": {
          "type": "string",
          "description": "Arrival time of the flight.",
          "format": "date-time"
        },
        "stops": {
          "type": "number",
          "description": "Number of stops the flight has."
        },
        "segments": {
          "type": "array",
          "description": "Array of segments (legs) for the flight.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "searchId",
        "price",
        "airlineCode",
        "departureTime",
        "arrivalTime"
      ]
    },
    "DestinationRecommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DestinationRecommendation",
      "type": "object",
      "description": "Represents a recommended travel destination.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the destination recommendation."
        },
        "city": {
          "type": "string",
          "description": "Name of the city."
        },
        "country": {
          "type": "string",
          "description": "Name of the country."
        },
        "iataCode": {
          "type": "string",
          "description": "IATA code for the destination airport."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to an image of the destination.",
          "format": "uri"
        },
        "averagePrice": {
          "type": "number",
          "description": "Average price of flights to this destination."
        }
      },
      "required": [
        "id",
        "city",
        "country",
        "iataCode",
        "imageUrl"
      ]
    },
    "Airline": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Airline",
      "type": "object",
      "description": "Represents an airline company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the airline."
        },
        "iataCode": {
          "type": "string",
          "description": "IATA code of the airline."
        },
        "name": {
          "type": "string",
          "description": "Name of the airline."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL to the airline's logo.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "iataCode",
        "name"
      ]
    },
    "TravelTip": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TravelTip",
      "type": "object",
      "description": "Represents a travel tip generated by AI for a specific destination.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the travel tip."
        },
        "destinationIata": {
          "type": "string",
          "description": "IATA code of the destination the tip is for."
        },
        "tipText": {
          "type": "string",
          "description": "The actual travel tip text."
        },
        "generatedTimestamp": {
          "type": "string",
          "description": "Timestamp of when the travel tip was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "destinationIata",
        "tipText"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, matching the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/flight_searches/{flightSearchId}",
        "definition": {
          "entityName": "FlightSearch",
          "schema": {
            "$ref": "#/backend/entities/FlightSearch"
          },
          "description": "Stores flight search queries made by the user. Path-based ownership allows users to only access their own searches.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who performed the flight search."
            },
            {
              "name": "flightSearchId",
              "description": "The unique ID of the flight search."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/flight_searches/{flightSearchId}/flight_offers/{flightOfferId}",
        "definition": {
          "entityName": "FlightOffer",
          "schema": {
            "$ref": "#/backend/entities/FlightOffer"
          },
          "description": "Stores flight offers associated with a user's flight search. Inherits user-specific ownership from the parent path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user who performed the flight search."
            },
            {
              "name": "flightSearchId",
              "description": "The unique ID of the flight search."
            },
            {
              "name": "flightOfferId",
              "description": "The unique ID of the flight offer."
            }
          ]
        }
      },
      {
        "path": "/destination_recommendations/{destinationRecommendationId}",
        "definition": {
          "entityName": "DestinationRecommendation",
          "schema": {
            "$ref": "#/backend/entities/DestinationRecommendation"
          },
          "description": "Stores recommended travel destinations. Globally accessible, but write access can be restricted.",
          "params": [
            {
              "name": "destinationRecommendationId",
              "description": "The unique ID of the destination recommendation."
            }
          ]
        }
      },
      {
        "path": "/airlines/{airlineId}",
        "definition": {
          "entityName": "Airline",
          "schema": {
            "$ref": "#/backend/entities/Airline"
          },
          "description": "Stores airline data. Globally accessible, but write access can be restricted.",
          "params": [
            {
              "name": "airlineId",
              "description": "The unique ID of the airline."
            }
          ]
        }
      },
      {
        "path": "/travel_tips/{travelTipId}",
        "definition": {
          "entityName": "TravelTip",
          "schema": {
            "$ref": "#/backend/entities/TravelTip"
          },
          "description": "Stores travel tips generated by AI for specific destinations. Globally accessible, no private user data stored.",
          "params": [
            {
              "name": "travelTipId",
              "description": "The unique ID of the travel tip."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and debuggability, following the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It leverages denormalization to avoid hierarchical authorization dependencies and structural segregation to simplify security rules.\n\n1.  **UserProfile**: User profiles are stored under `/users/{userId}`. This path-based ownership makes securing user-specific data straightforward.  It directly maps to the user's authentication ID.\n2.  **FlightSearch**: Flight searches are stored under `/users/{userId}/flight_searches/{flightSearchId}` to maintain the 1:N relationship between users and their searches. This hierarchical structure simplifies security rules for accessing a user's own searches.\n3.  **FlightOffer**: Flight offers related to a specific search are nested under `/users/{userId}/flight_searches/{flightSearchId}/flight_offers/{flightOfferId}`. This maintains the relationship and allows for easy retrieval of offers for a specific search.  It also inherits the user-specific ownership from the parent path.\n4.  **DestinationRecommendation**: Destination recommendations are stored in a flat `/destination_recommendations/{destinationRecommendationId}` collection.  These are globally accessible but can be secured to allow only admins to create/modify them if needed. This segregation simplifies access control, as all documents in this collection share the same security posture.\n5.  **Airline**: Airline data is stored in a flat `/airlines/{airlineId}` collection. Similar to DestinationRecommendation, this collection is globally accessible and can be secured to restrict modifications. This segregation simplifies access control.\n6.  **TravelTip**: Travel tips, specific to destinations, are stored in `/travel_tips/{travelTipId}`.  They are not directly associated with users, and their access is managed globally, thus simplifying the security rules.\n\n**Authorization Independence:** The structure avoids `get()` calls in security rules by embedding ownership within the document paths (e.g., `/users/{userId}`).  For collections like `flight_searches` and `flight_offers`, the `userId` is implicitly available in the path, eliminating the need to fetch parent documents to verify ownership.\n\n**QAPs (Rules are not Filters):**\n*   List operations are secured by the path-based ownership for user-specific data. Rules can easily enforce that a user can only list flight searches and offers under their own user ID.\n*   Global data collections like `destination_recommendations` and `airlines` can have rules that allow public read access but restrict write access to authorized users or roles (if implemented).\n*   The `travel_tips` collection allows for open access with no private user data stored in them."
  }
}
